
{
  "rules": {
    "users": {
      "$uid": {
        // A user can read their own profile, or an admin can read any profile.
        ".read": "auth != null && (auth.uid == $uid || (root.child('users').child(auth.uid).hasChild('accessiblePages') && root.child('users').child(auth.uid).child('accessiblePages').val().contains('/admin/team')))",
        // A user can write to their own profile, or an admin can write to any profile.
        ".write": "auth != null && (auth.uid == $uid || (root.child('users').child(auth.uid).hasChild('accessiblePages') && root.child('users').child(auth.uid).child('accessiblePages').val().contains('/admin/team')))"
      }
    },
    "menuItems": {
      // Anyone can read the menu.
      ".read": true,
      // Only admins can write to menu items.
      ".write": "auth != null && root.child('users').child(auth.uid).hasChild('accessiblePages') && root.child('users').child(auth.uid).child('accessiblePages').val().contains('/admin/menu')"
    },
    "preOrders": {
      // Users with access to the dashboard or the pre-orders page can read all pre-orders.
      ".read": "auth != null && root.child('users').child(auth.uid).hasChild('accessiblePages') && (root.child('users').child(auth.uid).child('accessiblePages').val().contains('/admin/pre-orders') || root.child('users').child(auth.uid).child('accessiblePages').val().contains('/admin'))",
      "$orderId": {
        // Anyone can create a new pre-order.
        // Admins and volunteers can update an existing one.
        ".write": "!data.exists() || (auth != null && root.child('users').child(auth.uid).hasChild('accessiblePages') && root.child('users').child(auth.uid).child('accessiblePages').val().contains('/admin/pre-orders'))"
      }
    },
    "sales": {
       // Any authenticated user can create a sale.
      ".write": "auth != null",
       // Users with access to the dashboard or analytics page can read sales data.
      ".read": "auth != null && root.child('users').child(auth.uid).hasChild('accessiblePages') && (root.child('users').child(auth.uid).child('accessiblePages').val().contains('/admin/analytics') || root.child('users').child(auth.uid).child('accessiblePages').val().contains('/admin'))"
    }
  }
}
